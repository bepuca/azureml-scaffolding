#!/usr/bin/env bash
#? [Package] Remove an package from the workspace

set -eo pipefail
cd "$(dirname "$0")/../.."


function usage {
    cat<<EOF
Remove an package from the project

Usage: $0 PACKAGE

Options:
    -h, --help            Show this help message and exit

Arguments:
  PACKAGE  Directory of the package relative to "$PKGS_PATH".

Remove a package from the project. This will remove the package directory
and uninstall it from the uv project.
EOF
}

bin/chkenv "PKGS_PATH"

while :; do
    case $1 in
        -h|--help) usage; exit ;;
        *) break ;;
    esac
    shift
done

if [ $# -ne 1 ]; then
    echo>&2 "PACKAGE required."
    usage>&2
    exit 1
fi

package=$1
if [[ ! -d "$PKGS_PATH/$package" ]]; then
    echo>&2 "Package directory '$PKGS_PATH/$package' does not exist."
    exit 1
fi

rm -rf "${PKGS_PATH:?}/$package"
uv remove "$package"